name: Block Unauthorized Merge Requests

on:
  pull_request:
    types: [opened, synchronize]
    branches:
      - main

jobs:
  check_label:
    runs-on: ubuntu-latest

    steps:
      - name: Check PR label
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          PR_NUMBER="${{ github.event.pull_request.number }}"
          LABELS=$(gh pr view "$PR_NUMBER" --json labels -q '.labels[].name')

          if echo "$LABELS" | grep -q "Auto-Merge"; then
            echo "âœ… This PR was created by the auto-merge script."
          else
            echo "ðŸš¨ Unauthorized PR detected! Closing PR..."
            gh pr close "$PR_NUMBER" --comment "This PR was manually created and does not have the required 'Auto-Merge' label. Please use the automated process."
            exit 1
          fi
